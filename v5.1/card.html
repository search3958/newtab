<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+2:wght@100..900&display=swap" rel="stylesheet">

<style>
  :root{
     --card-bg:#ffffffa6; --muted:#6b7280; --green:#10b981; --blue:#3b82f6; --red:#ef4444; --text:#0b1220; --card-shadow:rgba(2,6,23,0.06); --card-border:rgba(2,6,23,0.06); --label-color:rgba(0,0,0,0.6); --memo-bg:#ffffff; --memo-text:#111827; --memo-placeholder:#9ca3af; --fill-grad:linear-gradient(90deg, rgba(16,185,129,0.2), rgba(16,185,129,0.4)); --btn-bg:#ffffff; --btn-hover:#f3f4f6
  }
  
  @media (prefers-color-scheme: dark) {
    :root{
      --card-bg:#000000a6; --muted:#9ca3af; --text:#f9fafb; --card-shadow:rgba(0,0,0,0.3); --card-border:rgba(255,255,255,0.1); --label-color:rgba(255,255,255,0.5); --memo-bg:rgba(17,24,39,0.6); --memo-text:#f9fafb; --memo-placeholder:#6b7280; --fill-grad:linear-gradient(90deg, rgba(16,185,129,0.15), rgba(16,185,129,0.3)); --btn-bg:rgba(0, 0, 0, 0.9); --btn-hover:rgba(55,65,81,0.9)
    }
  }

  *{
  font-family: "M PLUS 2", sans-serif;
  }
  ::-webkit-scrollbar {
	display: none
  }
  html,body{height:100%;margin:0;padding:0;font-family:Inter,'Noto Sans JP',system-ui,-apple-system;background:transparent;color:var(--text);font-size:12px}

  .viewport{height:100%;width:100%;overflow-y:auto;-webkit-overflow-scrolling:touch;scroll-snap-type:y mandatory;position:relative}
  .slides{display:flex;flex-direction:column;height:100%}
  .slide{flex:0 0 100%;height:100%;box-sizing:border-box;padding:0px;scroll-snap-align:start}

  .card{position:relative;width:calc(100vw - 16px);height:calc(100vh - 16px);border-radius:14px;padding:8px;display:flex;flex-direction:column;justify-content:flex-start;gap:6px;overflow:hidden;background:var(--card-bg);transform-origin:center center}
  
  @media (prefers-color-scheme: dark) {
    .card{background:#000000a6;}
  }
  
  .card .overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;}
  .card .fill{position:absolute;top:0;left:0;height:100%;width:0;z-index:0;transition:width 0.4s ease;background:var(--fill-grad)}
  .card .content{position:relative;z-index:1;display:flex;flex-direction:column;height:100%}

  .pct{font-weight:600;font-variant-numeric:tabular-nums;color:var(--text)}
  .pct.large{font-size:34px;line-height:1}
  .sub{font-size:12px;color:var(--muted);margin-top:4px}

  .clock-date{display:flex;align-items:center;gap:8px}
  .date-big{font-weight:600;font-size:20px;color:var(--text)}
  .weekday{color:#ef4444;font-weight:600}
  .clock-time{font-weight:600;font-size:16px;color:var(--text)}
  .clock-sec{color:var(--muted);font-weight:600;margin-left:6px;font-size:16px}

  .memo-box{flex:1;display:flex;flex-direction:column;margin-top:8px}
  .memo-textarea{flex:1;width:100%;resize:none;border:none;outline:none;border-radius:6px;padding:8px;font-size:12px;color:var(--memo-text);background:none;box-sizing:border-box}
  .memo-textarea::placeholder{color:var(--memo-placeholder)}

  .controls{position:fixed;right:6px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:6px;z-index:60}
  .ctrlBtn{width:28px;height:28px;border-radius:60px;background:var(--btn-bg);border:1px solid var(--card-border);display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px var(--card-shadow);cursor:pointer}
  .ctrlBtn svg{width:14px;height:14px;fill:var(--muted)}
  .ctrlBtn:hover{background:var(--btn-hover)}

  .label-text{font-size:11px;color:var(--label-color);font-weight:700}
</style>
</head>
<body>
  <div id="viewport" class="viewport" tabindex="0" aria-label="Quick info panel">
    <div class="slides" id="slides">

      <section class="slide">
        <div class="card" id="batteryCard">
          <div class="overlay"></div>
          <div class="fill" id="battBar"></div>
          <div class="content">
            <div class="label-text">バッテリー</div>
            <div style="flex:1;display:flex;align-items:center;justify-content:space-between">
              <div>
                <div id="pct" class="pct large">--%</div>
                <div id="battLabel" class="sub">--</div>
              </div>
              <div style="display:none;" id="battTime">--</div>
            </div>
          </div>
        </div>
      </section>

      <section class="slide">
        <div class="card" id="timeCard">
          <div class="content">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:800;color:var(--text)">時計</div>
            </div>
            <div style="flex:1;display:flex;flex-direction:column;justify-content:center">
              <div class="clock-date"><div class="date-big" id="dateLarge">--.--</div><div class="weekday" id="weekday">---</div></div>
              <div style="height:6px"></div>
              <div style="display:flex;align-items:end;gap:6px">
                <div class="clock-time" id="timeVal">--:--</div>
                <div class="clock-sec" id="secVal">--</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="slide">
        <div class="card" id="noteCard" style="padding:0px;width: 100vw;height: 100vh;">
          <textarea id="memoText" class="memo-textarea" placeholder="クイックメモ" ></textarea>
        </div>
      </section>

    </div>
  </div>

  <div class="controls">
    <button id="upBtn" class="ctrlBtn" title="上へ" aria-label="上へ"><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button>
    <button id="downBtn" class="ctrlBtn" title="下へ" aria-label="下へ"><svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg></button>
  </div>

<script>
(function(){
  const vp = document.getElementById('viewport');
  const slideEls = Array.from(document.querySelectorAll('.slide'));
  let idx = 0, total = slideEls.length;
  const up = document.getElementById('upBtn'), down = document.getElementById('downBtn');

  function scrollTo(i,opts={behavior:'smooth'}){
    idx=(i+total)%total;
    const top = vp.clientHeight * idx;
    vp.scrollTo(Object.assign({top},opts));
  }

  up.addEventListener('click', ()=>{ scrollTo(idx-1); pauseAuto(); });
  down.addEventListener('click', ()=>{ scrollTo(idx+1); pauseAuto(); });

  // scale cards based on scroll position
  function updateCardScales(){
    const vpHeight = vp.clientHeight;
    const scrollTop = vp.scrollTop;
    
    slideEls.forEach((slide, i) => {
      const card = slide.querySelector('.card');
      const slideTop = i * vpHeight;
      const slideCenter = slideTop + vpHeight / 2;
      const vpCenter = scrollTop + vpHeight / 2;
      const distance = Math.abs(slideCenter - vpCenter);
      const maxDistance = vpHeight;
      
      // scale from 1.0 (center) to 0.85 (far)
      const scale = Math.max(0.85, 1 - (distance / maxDistance) * 0.15);
      const opacity = Math.max(0.6, 1 - (distance / maxDistance) * 0.4);
      
      card.style.transform = `scale(${scale})`;
      card.style.opacity = opacity;
    });
  }

  vp.addEventListener('scroll', updateCardScales, {passive:true});
  updateCardScales();

  // clock
  const dateLarge = document.getElementById('dateLarge');
  const weekday = document.getElementById('weekday');
  const timeVal = document.getElementById('timeVal');
  const secVal = document.getElementById('secVal');
  function pad(n){return String(n).padStart(2,'0')}
  function tick(){ const d=new Date(); dateLarge.textContent = pad(d.getMonth()+1) + '.' + pad(d.getDate()); weekday.textContent = d.toLocaleDateString('ja-JP',{weekday:'short'}); timeVal.textContent = pad(d.getHours())+':'+pad(d.getMinutes()); secVal.textContent = pad(d.getSeconds()); }
  setInterval(tick,1000); tick();

  // battery
  const pctEl = document.getElementById('pct');
  const battLabel = document.getElementById('battLabel');
  const battTime = document.getElementById('battTime');
  const battBar = document.getElementById('battBar');

  async function setupBattery(){
    if (!('getBattery' in navigator)) { pctEl.textContent='--%'; battLabel.textContent='未対応'; return; }
    try{
      const b = await navigator.getBattery();
      function render(){
        const p = Math.round(b.level*100);
        pctEl.textContent = p + '%';
        battBar.style.width = p+'%';
        if (b.charging) {
          battLabel.textContent = '充電中...';
        } else {
          if (p <= 5) battLabel.textContent = '急いでください';
          else if (p <= 15) battLabel.textContent = '充電しましょう';
          else if (p <= 40) battLabel.textContent = 'まだ持ちます';
          else if (p <= 60) battLabel.textContent = '持ちますね';
          else if (p <= 80) battLabel.textContent = 'ちょうどいいです';
          else if (p <= 100) battLabel.textContent = '充電済み';
          else battLabel.textContent = '限界突破';
        }
        battTime.textContent = b.charging ? (isFinite(b.chargingTime)&&b.chargingTime>0 ? Math.round(b.chargingTime/60)+'分' : '') : (isFinite(b.dischargingTime)&&b.dischargingTime>0 ? Math.round(b.dischargingTime/60)+'分' : '');
      }
      b.addEventListener('levelchange',render); b.addEventListener('chargingchange',render);
      render();
    }catch(e){ pctEl.textContent='Error'; battLabel.textContent='---'; }
  }
  setupBattery();

  // quick memo autosave
  const memoText = document.getElementById('memoText');
  const savedMemo = localStorage.getItem('quickMemo');
  if(savedMemo) memoText.value = savedMemo;
  memoText.addEventListener('input', ()=>{
    localStorage.setItem('quickMemo', memoText.value);
  });

  // auto-advance with pause on interaction
  let auto=true, autoTimer=null;
  function startAuto(){ if (autoTimer) clearInterval(autoTimer); autoTimer = setInterval(()=>{ if(auto){ idx=(idx+1)%total; scrollTo(idx); } },3000); }
  function pauseAuto(){ auto=false; if(autoTimer) clearInterval(autoTimer); if (window._resumeTimer) clearTimeout(window._resumeTimer); window._resumeTimer = setTimeout(()=>{ auto=true; startAuto(); },3500); }

  let scrollTimer = null;
  vp.addEventListener('scroll', ()=>{
    if (scrollTimer) clearTimeout(scrollTimer);
    scrollTimer = setTimeout(()=>{
      idx = Math.round(vp.scrollTop / vp.clientHeight);
      scrollTo(idx,{behavior:'smooth'});
    }, 120);
    pauseAuto();
  }, {passive:true});

  vp.addEventListener('pointerenter', ()=>{ auto=false; });
  vp.addEventListener('pointerleave', ()=>{ auto=true; });

  setTimeout(()=>{ scrollTo(0,{behavior:'auto'}); startAuto(); },150);

  window.addEventListener('keydown', (e)=>{ if (e.key === 'ArrowDown') { scrollTo(idx+1); pauseAuto(); } if (e.key === 'ArrowUp') { scrollTo(idx-1); pauseAuto(); } });

})();
</script>
</body>
</html>