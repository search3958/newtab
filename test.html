<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,200,0,0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+2:wght@100..900&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <title>Metaball 3D Hover</title>
  <style>
    *{
      font-family: "M PLUS 2", sans-serif;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    background-image: url(https://search3958.github.io/newtab/bgimg/joson1.webp);
    }

    .container {
      filter: contrast(25) blur(1px);
    mix-blend-mode: lighten;
      background:#000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      gap: 30px; /* 一定の間隔 */
      transition: all 1.3s cubic-bezier(0.17, 1.35, 0.08, 1);
    }

    .container.hide {
      gap: 0px;
    }

    .metaBall {
      position: relative;
      width: 120px;
      height: 120px;
      transition: all 0.6s cubic-bezier(.21,0,.21,1);
      scale:1;
      right:0px;
      z-index: 1;
    }

    .metaBall.search{
      width: 220px !important;
      transition: all 1.3s cubic-bezier(0.17, 1.35, 0.08, 1)!important;
    }
    /* メタボール風の見た目 */
    .metaBall::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 100px;
      background: rgba(255, 255, 255, 1);
      filter: blur(20px);
    }
    /* 追加: hideクラスで非表示 */
    .metaBall.hide {
      width: 60px;
      height: 60px;
      right:100px;
      transition: all 1.3s cubic-bezier(0.17, 1.35, 0.08, 1);
      filter: blur(5px);
    }
    .metaBall.search.hide {
      height: 130px;
      right:-90px;
      width: 500px !important;
      transition: all 1.3s cubic-bezier(0.17, 1.35, 0.08, 1)!important;
    }

    .linkedBalls {
      filter: none;
      border-radius: 100px;
      box-sizing: border-box;
      color: #000;
      text-align: center;
      opacity: 1;
      z-index: 2;
      transition: opacity 0.2s ease,filter 0.2s ease;
      filter:blur(0px);
      /* 位置・サイズ・レイアウト系はJSで制御 */
    }
    /* .hide時も連動 */
    .linkedBalls.hide {
      opacity: 0;
      filter:blur(8px);
    }
    /* .hide時も連動 */
    #linkedBalls-1 {
      opacity: 1!important;
      filter: blur(0px) !important;;

      z-index: 3;
    }
    #linkedBalls-4{
      background:color(display-p3 0.948 0.777 0 / 1);
    }
    /* .hide時も連動 */
    .linkedBall.hide {
      opacity: 0!important;
    }
    .iconbig {
    font-size: 50px;
    position: relative;
    top: 16%;
  }
  input.searchinput {
    height: 100%;
    width: 100%;
    border: none;
    border-radius: 100px;
    background: #0000;
    text-align: center;
    font-size: 39px;
    font-weight: 300;
    outline:none;
  }

</style>
</head>
<body>
  <!-- チェックボックス削除、テキストボックスのみ残す -->
  <div class="container">
    <div class="metaBall search" id="1"></div>
    <div class="metaBall" id="2"></div>
    <div class="metaBall" id="3"></div>
    <div class="metaBall" id="4"></div>
  </div>
  <!-- 修正: linkedBallsのidを分かりやすく -->
  <div class="linkedBalls" id="linkedBalls-1">
    <input class="searchinput" type="text" name="q" placeholder="検索" id="mainSearchInput">
  </div>
  <div class="linkedBalls" id="linkedBalls-2">
    <span class="material-symbols-outlined iconbig">settings</span>
  </div>
  <div class="linkedBalls" id="linkedBalls-3">
    <span class="material-symbols-outlined iconbig">history</span>
  </div>
  <div class="linkedBalls" id="linkedBalls-4">
    <span class="material-symbols-outlined iconbig">explore</span>
  </div>

  <script>
    const wrappers = document.querySelectorAll('.metaBall');

    // 位置・サイズを同期する関数（linkedBall生成部分は削除）
    function syncLinkedBalls() {
      wrappers.forEach(metaBall => {
        const linked = document.getElementById('linkedBalls-' + metaBall.id);
        const rect = metaBall.getBoundingClientRect();
        // サイズを少し小さく補正
        const offset = 4; // px
        linked.style.width = (rect.width - offset) + 'px';
        linked.style.height = (rect.height - offset) + 'px';
        linked.style.left = (rect.left + offset/2) + 'px';
        linked.style.top = (rect.top + offset/2) + 'px';
        linked.style.position = 'fixed';
        linked.style.lineHeight = (rect.height - offset) + 'px';
        // hideクラスも連動
        if (metaBall.classList.contains('hide')) {
          linked.classList.add('hide');
        } else {
          linked.classList.remove('hide');
        }
      });
    }
    // 初期・イベントごとに同期
    window.addEventListener('resize', syncLinkedBalls);

    // requestAnimationFrameで毎フレーム同期
    function syncLoop() {
      syncLinkedBalls();
      requestAnimationFrame(syncLoop);
    }
    syncLoop();

    // テキストボックス入力でhide制御
    const searchInput = document.getElementById('mainSearchInput');
    searchInput.addEventListener('input', function() {
      if (searchInput.value.length > 0) {
        wrappers.forEach(metaBall => metaBall.classList.add('hide'));
        document.querySelector('.container').classList.add('hide');
      } else {
        wrappers.forEach(metaBall => metaBall.classList.remove('hide'));
        document.querySelector('.container').classList.remove('hide');
      }
      syncLinkedBalls();
    });

    // metaBallのtransform変更時にも追従
    wrappers.forEach(metaBall => {
      metaBall.addEventListener('mousemove', syncLinkedBalls);
      metaBall.addEventListener('mouseleave', syncLinkedBalls);
    });

    // 初期化
    syncLinkedBalls();
  </script>
</body>
</html>
